package co.yedam;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.text.SimpleDateFormat;
import java.util.ArrayList;
import java.util.List;

// 데이터베이스 처리 기능
public class EmpDAO {
	Connection conn;
	PreparedStatement psmt;
	ResultSet rs;
	String sql;

	// 입력
	public boolean insertEmp(Employee emp) {
		conn = DAO.getConn(); // Connection 객체 생성
		
		// hire_date 포맷
		SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd");

		// 쿼리
		sql = "INSERT INTO employee (emp_no," 
				+ "emp_name," 
				+ "email,"
				+ "phone," 
				+ "hire_date," 
				+ "salary,"
				+ "department)" 
				+ "VALUES (?, ?, ?, ?, ?, ?, ?)";

		try {
			psmt = conn.prepareStatement(sql);
			psmt.setInt(1, emp.getEmpNo());
			psmt.setString(2, emp.getEmpName());
			psmt.setString(3, emp.getEmail());
			psmt.setString(4, emp.getPhone());
			psmt.setString(5, sdf.format(emp.getHireDate()));
			psmt.setInt(6, emp.getSalary());
			psmt.setString(7, emp.getDepartment());

			int r = psmt.executeUpdate(); // 데이터 반영
			if (r > 0) {
				return true;
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}

		return false;
	}

	// 목록
	public List<Employee> getList() {
		conn = DAO.getConn(); // Connection 객체 생성
		
		List<Employee> list = new ArrayList<>();

		sql = "SELECT emp_no, "
				+ "emp_name, "
				+ "email, "
				+ "phone, "
				+ "hire_date, "
				+ "salary, "
				+ "department "
				+ "FROM employee ORDER BY emp_no";
		
		try {
			psmt = conn.prepareStatement(sql);
			rs = psmt.executeQuery();

			while (rs.next()) {
				Employee emp = new Employee();
				emp.setEmpNo(rs.getInt("emp_no"));
				emp.setEmpName(rs.getString("emp_name"));
				emp.setEmail(rs.getString("email"));
				emp.setPhone(rs.getString("phone"));
				emp.setHireDate( rs.getDate("hire_date"));
				emp.setSalary(rs.getInt("salary"));
				emp.setDepartment(rs.getString("department"));
				
				list.add(emp); // DB -> Collection에 담기
			}
		} catch (SQLException e) {
			e.printStackTrace();
		}

		return null;
	}
}
